import 'package:flutter/cupertino.dart';
import 'package:image_picker/image_picker.dart';
import 'package:firebase_storage/firebase_storage.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';
import './screens/profile_screen.dart';
import 'dart:io';
import './app_config.dart';
import 'package:flutter/material.dart';

var _appConfigInstance = AppConfig();

class Storage {
  void uploadProfileImage(BuildContext context, File chosenImage) async {
    //final user = await FirebaseAuth.instance.currentUser();
    //final String userUID = user.uid;
    final String userUID = 'dyZIHP74wGM3Lt81G2wz';

    final StorageReference storageRef = FirebaseStorage.instance.ref().child(userUID).child('profile picture');

    final StorageUploadTask uploadTask = storageRef
        .child('profile picture' + '.jpg')
        .putFile(chosenImage);

    var imageUrl =
        await (await uploadTask.onComplete).ref.getDownloadURL();

    var url = imageUrl.toString();
    _appConfigInstance.uploadImageToDatabase(url);

    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => ProfileScreen()),
    );

    print("Image Url = " + url);
  }
}
